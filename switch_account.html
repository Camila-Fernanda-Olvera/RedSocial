<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambiar Cuenta - Quórum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .glass-panel {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        
        .account-card {
            transition: all 0.3s ease;
        }
        
        .account-card:hover {
            transform: translateY(-4px);
            border-color: #3b82f6;
        }
        
        .account-active {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-2xl">
        <div class="glass-panel rounded-2xl p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Cambiar Cuenta</h2>
                <button onclick="window.history.back()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div id="accountsList" class="space-y-3 mb-6">
                <!-- Las cuentas se cargarán dinámicamente aquí -->
            </div>

            <button onclick="addNewAccount()" class="w-full py-3 border-2 border-dashed border-gray-600 hover:border-blue-500 rounded-lg text-gray-400 hover:text-blue-500 transition flex items-center justify-center gap-2">
                <i class="fas fa-plus"></i>
                <span>Agregar cuenta</span>
            </button>
        </div>
    </div>

    <script>
        let accounts = JSON.parse(localStorage.getItem('quorum_accounts')) || [];
        let currentUser = JSON.parse(localStorage.getItem('quorum_user'));

        // Load and display accounts
        function loadAccounts() {
            const container = document.getElementById('accountsList');
            
            if (accounts.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No hay cuentas guardadas</div>';
                return;
            }

            container.innerHTML = accounts.map((account, index) => `
                <div class="account-card glass-panel rounded-lg p-4 cursor-pointer border-2 ${account.id === currentUser.id ? 'account-active' : 'border-transparent'}" onclick="switchToAccount(${index})">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <img src="${account.foto_perfil && account.foto_perfil.startsWith('data:') ? account.foto_perfil : 'assets/img/' + (account.foto_perfil || 'default_profile.png')}" 
                                 class="w-12 h-12 rounded-full object-cover border-2 ${account.id === currentUser.id ? 'border-green-500' : 'border-gray-600'}">
                            <div>
                                <p class="font-semibold">${account.nombre}</p>
                                <p class="text-sm text-gray-400">${account.email}</p>
                            </div>
                        </div>
                        ${account.id === currentUser.id ? '<i class="fas fa-check-circle text-green-500 text-xl"></i>' : ''}
                        ${account.id !== currentUser.id ? `<button onclick="event.stopPropagation(); removeAccount(${index})" class="text-gray-400 hover:text-red-400"><i class="fas fa-trash"></i></button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Switch to selected account
        function switchToAccount(index) {
            const account = accounts[index];
            
            if (account.id === currentUser.id) {
                window.history.back();
                return;
            }

            localStorage.setItem('quorum_user', JSON.stringify(account));
            window.location.href = 'feed.html';
        }

        // Remove account
        async function removeAccount(index) {
            const result = await Swal.fire({
                title: '¿Eliminar cuenta?',
                text: 'Solo se eliminará de esta lista, no de la base de datos',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar',
                background: '#1f2937',
                color: '#fff'
            });

            if (result.isConfirmed) {
                accounts.splice(index, 1);
                localStorage.setItem('quorum_accounts', JSON.stringify(accounts));
                loadAccounts();
            }
        }

        // Add new account
        function addNewAccount() {
            Swal.fire({
                title: 'Agregar nueva cuenta',
                text: 'Serás redirigido a la página de inicio de sesión',
                icon: 'info',
                confirmButtonColor: '#3b82f6',
                confirmButtonText: 'Continuar',
                background: '#1f2937',
                color: '#fff'
            }).then(() => {
                localStorage.setItem('add_new_account', 'true');
                window.location.href = 'Index.html';
            });
        }

        // Save current account if not already saved
        function saveCurrentAccount() {
            if (currentUser && !accounts.find(a => a.id === currentUser.id)) {
                accounts.push(currentUser);
                localStorage.setItem('quorum_accounts', JSON.stringify(accounts));
            }
        }

        // Initialize
        saveCurrentAccount();
        loadAccounts();
    </script>

</body>
</html>
